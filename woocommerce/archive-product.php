<?php
    /* Template Name: product category */
    //get header.php file
    get_header();
    
?>

<!-- *****************************\
             Main header
    \******************************/-->
<section class="main__header-container">
    <div class="header__container">
        <!-- *****************************\
                     Menu Principal
            \******************************/-->
        <div class="main__menu">
            <ul class="menu__options">
                <li class="main__options informatic">
                    <i class="material-icons">computer</i>
                    Informática
                    <i class="material-icons expand">expand_more</i>
                    <ul class="main__options-informatic ">
                        <li class="main__category-holder informatic-submenu">
                            <a href="" class="main__category">Computadores</a>
                            <div class="main__category-submenu">
                                <ul class="category__submenu-product">
                                    <li class="poduct__submenu"><a href="" class="product__type">Computadores Portáteis</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">Computadores de Mesa</a></li>
                                </ul>
                            </div>
                        </li>
                        <li class="main__category-holder">
                            <a href="" class="main__category">Armazenamento</a>
                            <div class="main__category-submenu">
                                <ul class="category__submenu-product">
                                    <li class="poduct__submenu"><a href="" class="product__type">Disco Externo</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">Pen USB</a></li>
                                </ul>
                            </div>
                        </li>
                        <li class="main__category-holder">
                            <a href="" class="main__category">Rede</a>
                            <div class="main__category-submenu">
                                <ul class="category__submenu-product">
                                    <li class="poduct__submenu"><a href="" class="product__type">Extensor de Sinal</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">Router</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">Switch</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">Telefone</a></li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </li>
                <li class="main__options tvbox">
                    <i class="material-icons">airplay</i>
                    TV Box
                    <i class="material-icons expand">expand_more</i>
                    <ul class="main__options-tvbox">
                        <li class="main__category-holder tvbox-submenu">
                            <a href="" class="main__category">Android Box</a>
                            <div class="main__category-submenu">
                                <ul class="category__submenu-product">
                                    <li class="poduct__submenu"><a href="" class="product__type">Android box 1</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">Android box 2</a></li>
                                </ul>
                            </div>
                        </li>
                        <li class="main__category-holder">
                            <a href="" class="main__category">Amazon</a>
                            <div class="main__category-submenu">
                                <ul class="category__submenu-product">
                                    <li class="poduct__submenu"><a href="" class="product__type">Fire Stick</a></li>

                                </ul>
                            </div>
                        </li>
                    </ul>
                </li>
                <li class="main__options tablet">
                    <i class="material-icons">stay_current_portrait</i>
                    Smartphones e Tablets
                    <i class="material-icons expand">expand_more</i>
                    <ul class="main__options-tablet">
                        <li class="main__category-holder tablet-submenu">
                            <a href="" class="main__category">Smartphones</a>
                            <div class="main__category-submenu">
                                <ul class="category__submenu-product">
                                    <li class="poduct__submenu"><a href="" class="product__type">iPhone</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">Android</a></li>
                                </ul>
                            </div>
                        </li>
                        <li class="main__category-holder">
                            <a href="" class="main__category">Smart Wathes</a>
                            <div class="main__category-submenu">
                                <ul class="category__submenu-product">
                                    <li class="poduct__submenu"><a href="" class="product__type">Apple</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">Android</a></li>
                                </ul>
                            </div>
                        </li>
                        <li class="main__category-holder">
                            <a href="" class="main__category">Tablet</a>
                            <div class="main__category-submenu">
                                <ul class="category__submenu-product">
                                    <li class="poduct__submenu"><a href="" class="product__type">iPad</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">Android</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">Surface</a></li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </li>
                <li class="main__options paper">
                    <i class="material-icons">library_books</i>
                    Consumívies e Papel
                    <i class="material-icons expand">expand_more</i>
                    <ul class="main__options-paper">
                        <li class="main__category-holder paper-submenu">
                            <a href="" class="main__category">Tinteiros</a>
                            <div class="main__category-submenu">
                                <ul class="category__submenu-product">
                                    <li class="poduct__submenu"><a href="" class="product__type">HP</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">Cannon</a></li>
                                </ul>
                            </div>
                        </li>
                        <li class="main__category-holder">
                            <a href="" class="main__category">Toner</a>
                            <div class="main__category-submenu">
                                <ul class="category__submenu-product">
                                    <li class="poduct__submenu"><a href="" class="product__type">HP</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">Ricoh</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">Kyocera</a></li>
                                </ul>
                            </div>
                        </li>
                        <li class="main__category-holder">
                            <a href="" class="main__category">Papel</a>
                            <div class="main__category-submenu">
                                <ul class="category__submenu-product">
                                    <li class="poduct__submenu"><a href="" class="product__type">Papel A4</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">Papel A3</a></li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </li>
                <li class="main__options games">
                    <i class="material-icons">sports_esports</i>
                    Jogos e Consola
                    <i class="material-icons expand">expand_more</i>
                    <ul class="main__options-games">
                        <li class="main__category-holder games-submenu">
                            <a href="" class="main__category">Jogos</a>
                            <div class="main__category-submenu">
                                <ul class="category__submenu-product">
                                    <li class="poduct__submenu"><a href="" class="product__type">PS5</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">PS4</a></li>
                                </ul>
                            </div>
                        </li>
                        <li class="main__category-holder">
                            <a href="" class="main__category">Consolas</a>
                            <div class="main__category-submenu">
                                <ul class="category__submenu-product">
                                    <li class="poduct__submenu"><a href="" class="product__type">PS5</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">XBOX</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">PS4</a></li>
                                </ul>
                            </div>
                        </li>
                        <li class="main__category-holder">
                            <a href="" class="main__category">Acessórios</a>
                            <div class="main__category-submenu">
                                <ul class="category__submenu-product">
                                    <li class="poduct__submenu"><a href="" class="product__type">Headphones</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">Capas PS5</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">Capas PS4</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">Comandos PS5</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">Comandos PS4</a></li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </li>
                <li class="main__options printer">
                    <i class="material-icons">adf_scanner</i>
                    Impressoras e Scaners
                    <i class="material-icons expand">expand_more</i>
                    <ul class="main__options-printer">
                        <li class="main__category-holder printer-submenu">
                            <a href="" class="main__category">Impressoras</a>
                            <div class="main__category-submenu">
                                <ul class="category__submenu-product">
                                    <li class="poduct__submenu"><a href="" class="product__type">HP</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">Ricoh</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">Kyocera</a></li>
                                </ul>
                            </div>
                        </li>
                        <li class="main__category-holder">
                            <a href="" class="main__category">Scanners</a>
                            <div class="main__category-submenu">
                                <ul class="category__submenu-product">
                                    <li class="poduct__submenu"><a href="" class="product__type">HP</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">Brother</a></li>
                                    <li class="poduct__submenu"><a href="" class="product__type">Fujitsu</a></li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </li>
            </ul>

        </div>


        <?php
                //Pegar as informações da categoria que está a ser passada
                $product_cat = get_queried_object();
                //print_r($product_cat);
                
                // To be sure that is a WP_Term Object to avoid errors
                if( is_a($product_cat, 'WP_Term') ) :

                    // Setup your custom query
                    $loop = new WP_Query( array(
                        'post_type'      => 'product',                    
                        'post_status'    => 'publish',
                        'tax_query'      => array( array(
                            'taxonomy' => 'product_cat', // The taxonomy name
                            'field'    => 'term_id', // Type of field ('term_id', 'slug', 'name' or 'term_taxonomy_id')
                            'terms'    => $product_cat->term_id, // can be an integer, a string or an array
                        ) ),
                    ) );
            
                //print_r($loop);
            ?>
        <div class="catgories__container">
            <div class="categories__container-header">
                <span class="categories__container-title"><?php echo $product_cat->name ?></span>

                <div class="categories__buttons-holder">
                    <button class="button__view">
                        <i class="material-icons">grid_view</i>
                    </button>
                    <button class="button__view">
                        <i class="material-icons">view_list</i>
                    </button>
                    <select name="ordenar" id="" class="orderBy">
                        <option value="0">Ordenar por</option>
                        <option value="1">Preço: mais barato primeiro</option>
                        <option value="2">Preço: mais caro primeiro</option>
                        <option value="3">Data: mais recente primeiro</option>
                        <option value="4">Data: mais antigo primeiro</option>
                        <option value="3">Mais vendidos</option>
                        <option value="4">Melhores avaliados</option>
                    </select>
                </div>
            </div>


            <div class="new__products-list">

                <?php
   // print_r($loop);
                            if ( $loop->have_posts() ) :
                                while ( $loop->have_posts() ) : $loop->the_post();
                                    
                                    $product = wc_get_product( get_the_ID());
                                    
                                    ?>
                                    <div class="product__card">
                                        <div class="product__img">
                                            <?php if($product->get_sale_price()):?>
                                                <div class="product__discount">
                                                    <?php echo round((1-($product->get_sale_price()/$product->get_regular_price()))*100); ?>%
                                                </div>
                                            <?php endif?>
                                            <a href="<?php echo get_the_permalink() ?>">
                                                <?php the_post_thumbnail(); ?>
                                                <!--img src="./img/1-300x300.jpg" alt=""-->
                                            </a>
                                        </div>
                                        <div class="product__details">
                                            <a href="produto.php">
                                                <span><?php echo the_title(); ?></span>
                                                <div class="rating">
                                                    <i class="material-icons">star</i>
                                                    <i class="material-icons">star</i>
                                                    <i class="material-icons">star</i>
                                                    <i class="material-icons">star</i>
                                                    <i class="material-icons">star_half</i>
                                                </div>
                                                <!--p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Repellendus, sit.</p-->
                                                <div class="price__holder">
                                                    <?php if($product->get_sale_price()):?>
                                                        <div class="product__price">Kz <?php echo $product->get_sale_price();?></div>
                                                        <div class="product__price-old"><del>Kz <?php echo $product->get_regular_price(); ?></del></div>
                                                    <?php else:?>
                                                        <div class="product__price">Kz <?php echo $product->get_regular_price();?></div>
                                                    <?php endif?>
                                                    <!--div class="product__price">AOA 90.000</div>
                                                    <div class="product__price-old"><del>AOA 100.000</del></div-->
                                                </div>
                                            </a>
                                            <div class="product__buttons">
                                                <button class="product__btn" id="infoProductModal"><i class="material-icons">remove_red_eye</i></button>
                                                <button class="product__btn"><i class="material-icons">favorite_border</i></button>
                                                <button class="product__btn"><i class="material-icons">shopping_cart</i></button>

                                            </div>
                                        </div>
                                    </div>
                                    <?php
                                endwhile;
                            wp_reset_postdata(); // Remember to reset
                            endif; 
                        endif;
                        
                ?>

            </div>
        </div>

    </div>
</section>



<?php 
    //get footer.php file
    get_footer(); 
    print_r($loop);
?>
